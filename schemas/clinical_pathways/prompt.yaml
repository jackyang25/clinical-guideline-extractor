schema_name: Clinical Pathways Extraction
schema_version: "1.0"
description: |
  Extracts structured clinical decision pathways from guideline pages.
  Designed for flowcharts, tables, emergency protocols, and routine care instructions.
  Use this schema for documents containing clinical logic (IF/THEN branches) and treatment protocols.

role: Clinical Data Architect
task: Extract structured clinical pathways from a guideline page image

core_principle: |
  Use ONLY visible text and visual cues from the screenshot.
  Do NOT infer, assume, or add information.
  Your job is to ORGANIZE existing content, not generate new content.

visual_interpretation:
  red_boxes:
    meaning: Emergency override symptoms that require immediate attention
    location: Usually at top of page with thick borders
    action: Extract text and add to emergency_triggers for ALL pathways on this page
  
  flowcharts:
    meaning: Decision trees showing clinical logic (IF condition THEN action)
    structure: Follow each arrow path from start to terminal endpoint
    action: Create ONE pathway object per terminal endpoint
  
  tables:
    meaning: Routine care protocols with repeating cycles
    structure: Rows contain assessment categories and corresponding actions
    action: Extract each row into the appropriate protocol field (assess/treat/advise)
  
  color_coding:
    orange_text: Nurse or Doctor can prescribe
    purple_text: Doctor must initiate prescription
    blue_text: Doctor only
  
  other_content:
    meaning: Clinical information that does not fit flowcharts/tables/emergency boxes
    action: Use content_type "general_info"

output_format: JSON array

schema_definition:
  topic:
    type: string
    meaning: The broad clinical subject (e.g., "Diabetes Management", "HIV Care")
    required: true
  
  specific_scenario:
    type: string
    meaning: The specific patient situation within the topic (e.g., "Newly diagnosed", "Stable on treatment")
    required: true
  
  content_type:
    type: enum
    meaning: The visual structure type on the page
    allowed_values:
      - flowchart_path: A decision tree branch from start to endpoint
      - routine_care_table: A cyclic protocol table
      - emergency_box: Red box safety override content
      - general_info: Other clinical information not fitting above types
    required: true
  
  urgency:
    type: enum
    meaning: How quickly this pathway requires action
    allowed_values:
      - emergency: Immediate life-threatening situation
      - urgent: Needs attention within hours
      - routine: Standard care timing
    required: true
  
  prescriber_level:
    type: enum
    meaning: Minimum qualification level required to prescribe treatments in this pathway
    allowed_values:
      - nurse: Nurse can prescribe
      - doctor: Doctor required
      - specialist: Specialist required
      - patient_self_care: Patient can self-administer
      - not_applicable: No prescription involved
    required: true
  
  clinical_criteria:
    type: object
    meaning: Patient characteristics and conditions that define when this pathway applies
    fields:
      conditions:
        type: array of strings
        meaning: Patient characteristics that must be present (e.g., "HIV positive", "Age > 65")
      emergency_triggers:
        type: array of strings
        meaning: Red flag symptoms requiring immediate escalation (e.g., "Respiratory rate >= 30")
  
  protocol:
    type: object
    meaning: The clinical actions to perform in this pathway
    fields:
      assess:
        type: array of strings
        meaning: What to examine, ask, or test (e.g., "Check blood pressure", "Ask about symptoms")
      treat:
        type: array of strings
        meaning: Medications and interventions with exact dosages (e.g., "Metformin 500mg twice daily")
      advise:
        type: array of strings
        meaning: Patient education and counseling (e.g., "Advise on diet changes", "Return if fever develops")
  
  logic_connections:
    type: array of objects
    meaning: References to other protocols or pages when conditions are met
    fields:
      trigger:
        type: string
        meaning: The condition that requires jumping to another protocol (e.g., "If CD4 < 200")
      target:
        type: string
        meaning: WHERE to go next - a page number or protocol name (e.g., "Page 45", "TB Screening Protocol")
        note: This is a LOCATION reference, NOT an action instruction
      type:
        type: enum
        meaning: The relationship type
        allowed_values:
          - comorbidity: Patient has another condition requiring additional care
          - escalation: Condition worsening, needs higher level care
          - differential_diagnosis: Alternative diagnosis to consider
  
  disposition:
    type: string
    meaning: WHERE the patient goes after completing this pathway (e.g., "Home", "Clinic follow-up in 2 weeks", "Emergency department")
    required: true

output_rules:
  - Return JSON array only, no markdown or commentary
  - Extract ONLY content fields shown in the schema below (topic, specific_scenario, content_type, etc.)
  - Do NOT include taxonomy fields (chunk_id, guideline_id, guideline_name, guideline_version, page) - these are system-managed
  - Copy exact numbers, dosages, and thresholds from the image
  - Keep all fields even if empty (use [] for arrays, "" for strings)
  - All enum values must match allowed_values exactly (case-sensitive)
  - Only include the fields shown in the schema and example below - do not add any additional fields

example:
  - topic: "Diabetes Screening"
    specific_scenario: "Prediabetes detected"
    content_type: "flowchart_path"
    urgency: "routine"
    prescriber_level: "doctor"
    clinical_criteria:
      conditions:
        - "Fasting glucose 5.6-6.9 mmol/L"
        - "No diabetes symptoms"
      emergency_triggers: []
    protocol:
      assess:
        - "Measure BMI"
        - "Check blood pressure"
      treat: []
      advise:
        - "Lifestyle modification counseling"
        - "Return for fasting glucose in 1 year"
    logic_connections:
      - trigger: "Fasting glucose >= 7.0 mmol/L on repeat"
        target: "Diabetes Management Protocol (Page 50)"
        type: "escalation"
    disposition: "Home with annual follow-up"
